#!/usr/bin/env python3
"""
åˆå§‹åŒ–çœä»½å’ŒåŸå¸‚æ•°æ®
"""

from database import engine, SessionLocal
from models import Base, Province, City

# ä¸­å›½çœä»½å’ŒåŸå¸‚æ•°æ®
PROVINCES_AND_CITIES = {
    "åŒ—äº¬å¸‚": ["åŒ—äº¬å¸‚"],
    "å¤©æ´¥å¸‚": ["å¤©æ´¥å¸‚"],
    "æ²³åŒ—çœ": ["çŸ³å®¶åº„å¸‚", "å”å±±å¸‚", "ç§¦çš‡å²›å¸‚", "é‚¯éƒ¸å¸‚", "é‚¢å°å¸‚", "ä¿å®šå¸‚", "å¼ å®¶å£å¸‚", "æ‰¿å¾·å¸‚", "æ²§å·å¸‚", "å»ŠåŠå¸‚", "è¡¡æ°´å¸‚"],
    "å±±è¥¿çœ": ["å¤ªåŸå¸‚", "å¤§åŒå¸‚", "é˜³æ³‰å¸‚", "é•¿æ²»å¸‚", "æ™‹åŸå¸‚", "æœ”å·å¸‚", "æ™‹ä¸­å¸‚", "è¿åŸå¸‚", "å¿»å·å¸‚", "ä¸´æ±¾å¸‚", "å•æ¢å¸‚"],
    "å†…è’™å¤è‡ªæ²»åŒº": ["å‘¼å’Œæµ©ç‰¹å¸‚", "åŒ…å¤´å¸‚", "ä¹Œæµ·å¸‚", "èµ¤å³°å¸‚", "é€šè¾½å¸‚", "é„‚å°”å¤šæ–¯å¸‚", "å‘¼ä¼¦è´å°”å¸‚", "å·´å½¦æ·–å°”å¸‚", "ä¹Œå…°å¯Ÿå¸ƒå¸‚", "å…´å®‰ç›Ÿ", "é”¡æ—éƒ­å‹’ç›Ÿ", "é˜¿æ‹‰å–„ç›Ÿ"],
    "è¾½å®çœ": ["æ²ˆé˜³å¸‚", "å¤§è¿å¸‚", "éå±±å¸‚", "æŠšé¡ºå¸‚", "æœ¬æºªå¸‚", "ä¸¹ä¸œå¸‚", "é”¦å·å¸‚", "è¥å£å¸‚", "é˜œæ–°å¸‚", "è¾½é˜³å¸‚", "ç›˜é”¦å¸‚", "é“å²­å¸‚", "æœé˜³å¸‚", "è‘«èŠ¦å²›å¸‚"],
    "å‰æ—çœ": ["é•¿æ˜¥å¸‚", "å‰æ—å¸‚", "å››å¹³å¸‚", "è¾½æºå¸‚", "é€šåŒ–å¸‚", "ç™½å±±å¸‚", "æ¾åŸå¸‚", "ç™½åŸå¸‚", "å»¶è¾¹æœé²œæ—è‡ªæ²»å·"],
    "é»‘é¾™æ±Ÿçœ": ["å“ˆå°”æ»¨å¸‚", "é½é½å“ˆå°”å¸‚", "é¸¡è¥¿å¸‚", "é¹¤å²—å¸‚", "åŒé¸­å±±å¸‚", "å¤§åº†å¸‚", "ä¼Šæ˜¥å¸‚", "ä½³æœ¨æ–¯å¸‚", "ä¸ƒå°æ²³å¸‚", "ç‰¡ä¸¹æ±Ÿå¸‚", "é»‘æ²³å¸‚", "ç»¥åŒ–å¸‚", "å¤§å…´å®‰å²­åœ°åŒº"],
    "ä¸Šæµ·å¸‚": ["ä¸Šæµ·å¸‚"],
    "æ±Ÿè‹çœ": ["å—äº¬å¸‚", "æ— é”¡å¸‚", "å¾å·å¸‚", "å¸¸å·å¸‚", "è‹å·å¸‚", "å—é€šå¸‚", "è¿äº‘æ¸¯å¸‚", "æ·®å®‰å¸‚", "ç›åŸå¸‚", "æ‰¬å·å¸‚", "é•‡æ±Ÿå¸‚", "æ³°å·å¸‚", "å®¿è¿å¸‚"],
    "æµ™æ±Ÿçœ": ["æ­å·å¸‚", "å®æ³¢å¸‚", "æ¸©å·å¸‚", "å˜‰å…´å¸‚", "æ¹–å·å¸‚", "ç»å…´å¸‚", "é‡‘åå¸‚", "è¡¢å·å¸‚", "èˆŸå±±å¸‚", "å°å·å¸‚", "ä¸½æ°´å¸‚"],
    "å®‰å¾½çœ": ["åˆè‚¥å¸‚", "èŠœæ¹–å¸‚", "èšŒåŸ å¸‚", "æ·®å—å¸‚", "é©¬éå±±å¸‚", "æ·®åŒ—å¸‚", "é“œé™µå¸‚", "å®‰åº†å¸‚", "é»„å±±å¸‚", "æ»å·å¸‚", "é˜œé˜³å¸‚", "å®¿å·å¸‚", "å…­å®‰å¸‚", "äº³å·å¸‚", "æ± å·å¸‚", "å®£åŸå¸‚"],
    "ç¦å»ºçœ": ["ç¦å·å¸‚", "å¦é—¨å¸‚", "è†ç”°å¸‚", "ä¸‰æ˜å¸‚", "æ³‰å·å¸‚", "æ¼³å·å¸‚", "å—å¹³å¸‚", "é¾™å²©å¸‚", "å®å¾·å¸‚"],
    "æ±Ÿè¥¿çœ": ["å—æ˜Œå¸‚", "æ™¯å¾·é•‡å¸‚", "èä¹¡å¸‚", "ä¹æ±Ÿå¸‚", "æ–°ä½™å¸‚", "é¹°æ½­å¸‚", "èµ£å·å¸‚", "å‰å®‰å¸‚", "å®œæ˜¥å¸‚", "æŠšå·å¸‚", "ä¸Šé¥¶å¸‚"],
    "å±±ä¸œçœ": ["æµå—å¸‚", "é’å²›å¸‚", "æ·„åšå¸‚", "æ£åº„å¸‚", "ä¸œè¥å¸‚", "çƒŸå°å¸‚", "æ½åŠå¸‚", "æµå®å¸‚", "æ³°å®‰å¸‚", "å¨æµ·å¸‚", "æ—¥ç…§å¸‚", "è±èŠœå¸‚", "ä¸´æ²‚å¸‚", "å¾·å·å¸‚", "èŠåŸå¸‚", "æ»¨å·å¸‚", "èæ³½å¸‚"],
    "æ²³å—çœ": ["éƒ‘å·å¸‚", "å¼€å°å¸‚", "æ´›é˜³å¸‚", "å¹³é¡¶å±±å¸‚", "å®‰é˜³å¸‚", "é¹¤å£å¸‚", "æ–°ä¹¡å¸‚", "ç„¦ä½œå¸‚", "æ¿®é˜³å¸‚", "è®¸æ˜Œå¸‚", "æ¼¯æ²³å¸‚", "ä¸‰é—¨å³¡å¸‚", "å—é˜³å¸‚", "å•†ä¸˜å¸‚", "ä¿¡é˜³å¸‚", "å‘¨å£å¸‚", "é©»é©¬åº—å¸‚", "æµæºå¸‚"],
    "æ¹–åŒ—çœ": ["æ­¦æ±‰å¸‚", "é»„çŸ³å¸‚", "åå °å¸‚", "å®œæ˜Œå¸‚", "è¥„é˜³å¸‚", "é„‚å·å¸‚", "è†é—¨å¸‚", "å­æ„Ÿå¸‚", "è†å·å¸‚", "é»„å†ˆå¸‚", "å’¸å®å¸‚", "éšå·å¸‚", "æ©æ–½åœŸå®¶æ—è‹—æ—è‡ªæ²»å·"],
    "æ¹–å—çœ": ["é•¿æ²™å¸‚", "æ ªæ´²å¸‚", "æ¹˜æ½­å¸‚", "è¡¡é˜³å¸‚", "é‚µé˜³å¸‚", "å²³é˜³å¸‚", "å¸¸å¾·å¸‚", "å¼ å®¶ç•Œå¸‚", "ç›Šé˜³å¸‚", "éƒ´å·å¸‚", "æ°¸å·å¸‚", "æ€€åŒ–å¸‚", "å¨„åº•å¸‚", "æ¹˜è¥¿åœŸå®¶æ—è‹—æ—è‡ªæ²»å·"],
    "å¹¿ä¸œçœ": ["å¹¿å·å¸‚", "éŸ¶å…³å¸‚", "æ·±åœ³å¸‚", "ç æµ·å¸‚", "æ±•å¤´å¸‚", "ä½›å±±å¸‚", "æ±Ÿé—¨å¸‚", "æ¹›æ±Ÿå¸‚", "èŒ‚åå¸‚", "è‚‡åº†å¸‚", "æƒ å·å¸‚", "æ¢…å·å¸‚", "æ±•å°¾å¸‚", "æ²³æºå¸‚", "é˜³æ±Ÿå¸‚", "æ¸…è¿œå¸‚", "ä¸œèå¸‚", "ä¸­å±±å¸‚", "æ½®å·å¸‚", "æ­é˜³å¸‚", "äº‘æµ®å¸‚"],
    "å¹¿è¥¿å£®æ—è‡ªæ²»åŒº": ["å—å®å¸‚", "æŸ³å·å¸‚", "æ¡‚æ—å¸‚", "æ¢§å·å¸‚", "åŒ—æµ·å¸‚", "é˜²åŸæ¸¯å¸‚", "é’¦å·å¸‚", "è´µæ¸¯å¸‚", "ç‰æ—å¸‚", "ç™¾è‰²å¸‚", "è´ºå·å¸‚", "æ²³æ± å¸‚", "æ¥å®¾å¸‚", "å´‡å·¦å¸‚"],
    "æµ·å—çœ": ["æµ·å£å¸‚", "ä¸‰äºšå¸‚", "ä¸‰æ²™å¸‚", "å„‹å·å¸‚"],
    "é‡åº†å¸‚": ["é‡åº†å¸‚"],
    "å››å·çœ": ["æˆéƒ½å¸‚", "è‡ªè´¡å¸‚", "æ”€æèŠ±å¸‚", "æ³¸å·å¸‚", "å¾·é˜³å¸‚", "ç»µé˜³å¸‚", "å¹¿å…ƒå¸‚", "é‚å®å¸‚", "å†…æ±Ÿå¸‚", "ä¹å±±å¸‚", "å—å……å¸‚", "çœ‰å±±å¸‚", "å®œå®¾å¸‚", "å¹¿å®‰å¸‚", "è¾¾å·å¸‚", "é›…å®‰å¸‚", "å·´ä¸­å¸‚", "èµ„é˜³å¸‚", "é˜¿åè—æ—ç¾Œæ—è‡ªæ²»å·", "ç”˜å­œè—æ—è‡ªæ²»å·", "å‡‰å±±å½æ—è‡ªæ²»å·"],
    "è´µå·çœ": ["è´µé˜³å¸‚", "å…­ç›˜æ°´å¸‚", "éµä¹‰å¸‚", "å®‰é¡ºå¸‚", "æ¯•èŠ‚å¸‚", "é“œä»å¸‚", "é»”è¥¿å—å¸ƒä¾æ—è‹—æ—è‡ªæ²»å·", "é»”ä¸œå—è‹—æ—ä¾—æ—è‡ªæ²»å·", "é»”å—å¸ƒä¾æ—è‹—æ—è‡ªæ²»å·"],
    "äº‘å—çœ": ["æ˜†æ˜å¸‚", "æ›²é–å¸‚", "ç‰æºªå¸‚", "ä¿å±±å¸‚", "æ˜­é€šå¸‚", "ä¸½æ±Ÿå¸‚", "æ™®æ´±å¸‚", "ä¸´æ²§å¸‚", "æ¥šé›„å½æ—è‡ªæ²»å·", "çº¢æ²³å“ˆå°¼æ—å½æ—è‡ªæ²»å·", "æ–‡å±±å£®æ—è‹—æ—è‡ªæ²»å·", "è¥¿åŒç‰ˆçº³å‚£æ—è‡ªæ²»å·", "å¤§ç†ç™½æ—è‡ªæ²»å·", "å¾·å®å‚£æ—æ™¯é¢‡æ—è‡ªæ²»å·", "æ€’æ±Ÿå‚ˆåƒ³æ—è‡ªæ²»å·", "è¿ªåº†è—æ—è‡ªæ²»å·"],
    "è¥¿è—è‡ªæ²»åŒº": ["æ‹‰è¨å¸‚", "æ—¥å–€åˆ™å¸‚", "æ˜Œéƒ½å¸‚", "æ—èŠå¸‚", "å±±å—å¸‚", "é‚£æ›²å¸‚", "é˜¿é‡Œåœ°åŒº"],
    "é™•è¥¿çœ": ["è¥¿å®‰å¸‚", "é“œå·å¸‚", "å®é¸¡å¸‚", "å’¸é˜³å¸‚", "æ¸­å—å¸‚", "å»¶å®‰å¸‚", "æ±‰ä¸­å¸‚", "æ¦†æ—å¸‚", "å®‰åº·å¸‚", "å•†æ´›å¸‚"],
    "ç”˜è‚ƒçœ": ["å…°å·å¸‚", "å˜‰å³ªå…³å¸‚", "é‡‘æ˜Œå¸‚", "ç™½é“¶å¸‚", "å¤©æ°´å¸‚", "æ­¦å¨å¸‚", "å¼ æ–å¸‚", "å¹³å‡‰å¸‚", "é…’æ³‰å¸‚", "åº†é˜³å¸‚", "å®šè¥¿å¸‚", "é™‡å—å¸‚", "ä¸´å¤å›æ—è‡ªæ²»å·", "ç”˜å—è—æ—è‡ªæ²»å·"],
    "é’æµ·çœ": ["è¥¿å®å¸‚", "æµ·ä¸œå¸‚", "æµ·åŒ—è—æ—è‡ªæ²»å·", "é»„å—è—æ—è‡ªæ²»å·", "æµ·å—è—æ—è‡ªæ²»å·", "æœæ´›è—æ—è‡ªæ²»å·", "ç‰æ ‘è—æ—è‡ªæ²»å·", "æµ·è¥¿è’™å¤æ—è—æ—è‡ªæ²»å·"],
    "å®å¤å›æ—è‡ªæ²»åŒº": ["é“¶å·å¸‚", "çŸ³å˜´å±±å¸‚", "å´å¿ å¸‚", "å›ºåŸå¸‚", "ä¸­å«å¸‚"],
    "æ–°ç–†ç»´å¾å°”è‡ªæ²»åŒº": ["ä¹Œé²æœ¨é½å¸‚", "å…‹æ‹‰ç›ä¾å¸‚", "åé²ç•ªå¸‚", "å“ˆå¯†å¸‚", "æ˜Œå‰å›æ—è‡ªæ²»å·", "åšå°”å¡”æ‹‰è’™å¤è‡ªæ²»å·", "å·´éŸ³éƒ­æ¥è’™å¤è‡ªæ²»å·", "é˜¿å…‹è‹åœ°åŒº", "å…‹å­œå‹’è‹æŸ¯å°”å…‹å­œè‡ªæ²»å·", "å–€ä»€åœ°åŒº", "å’Œç”°åœ°åŒº", "ä¼ŠçŠå“ˆè¨å…‹è‡ªæ²»å·", "å¡”åŸåœ°åŒº", "é˜¿å‹’æ³°åœ°åŒº"],
    "å°æ¹¾çœ": ["å°åŒ—å¸‚", "æ–°åŒ—å¸‚", "æ¡ƒå›­å¸‚", "å°ä¸­å¸‚", "å°å—å¸‚", "é«˜é›„å¸‚", "åŸºéš†å¸‚", "æ–°ç«¹å¸‚", "å˜‰ä¹‰å¸‚", "æ–°ç«¹å¿", "è‹—æ —å¿", "å½°åŒ–å¿", "å—æŠ•å¿", "äº‘æ—å¿", "å˜‰ä¹‰å¿", "å±ä¸œå¿", "å®œå…°å¿", "èŠ±è²å¿", "å°ä¸œå¿", "æ¾æ¹–å¿", "é‡‘é—¨å¿", "è¿æ±Ÿå¿"],
    "é¦™æ¸¯ç‰¹åˆ«è¡Œæ”¿åŒº": ["é¦™æ¸¯ç‰¹åˆ«è¡Œæ”¿åŒº"],
    "æ¾³é—¨ç‰¹åˆ«è¡Œæ”¿åŒº": ["æ¾³é—¨ç‰¹åˆ«è¡Œæ”¿åŒº"]
}

def init_provinces_and_cities():
    """åˆå§‹åŒ–çœä»½å’ŒåŸå¸‚æ•°æ®"""
    db = SessionLocal()
    
    try:
        # æ£€æŸ¥æ˜¯å¦å·²æœ‰æ•°æ®
        existing_provinces = db.query(Province).count()
        if existing_provinces > 0:
            print("âœ… çœä»½å’ŒåŸå¸‚æ•°æ®å·²å­˜åœ¨ï¼Œè·³è¿‡åˆå§‹åŒ–")
            return
        
        print("ğŸ”„ å¼€å§‹åˆå§‹åŒ–çœä»½å’ŒåŸå¸‚æ•°æ®...")
        
        # åˆ›å»ºçœä»½å’ŒåŸå¸‚æ•°æ®
        for province_name, cities in PROVINCES_AND_CITIES.items():
            # åˆ›å»ºçœä»½
            province_code = f"P{len(db.query(Province).all()) + 1:03d}"
            province = Province(
                name=province_name,
                code=province_code
            )
            db.add(province)
            db.flush()  # è·å–çœä»½ID
            
            # åˆ›å»ºåŸå¸‚
            for i, city_name in enumerate(cities):
                city_code = f"C{province.id}{i+1:02d}"
                city = City(
                    name=city_name,
                    code=city_code,
                    province_id=province.id
                )
                db.add(city)
        
        db.commit()
        print(f"âœ… æˆåŠŸåˆå§‹åŒ– {len(PROVINCES_AND_CITIES)} ä¸ªçœä»½å’Œ {sum(len(cities) for cities in PROVINCES_AND_CITIES.values())} ä¸ªåŸå¸‚")
        
    except Exception as e:
        db.rollback()
        print(f"âŒ åˆå§‹åŒ–æ•°æ®å¤±è´¥: {e}")
        raise
    finally:
        db.close()

if __name__ == "__main__":
    # åˆ›å»ºæ•°æ®åº“è¡¨
    Base.metadata.create_all(bind=engine)
    
    # åˆå§‹åŒ–æ•°æ®
    init_provinces_and_cities() 